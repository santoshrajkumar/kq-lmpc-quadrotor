
# ğŸš ğŸ›¸ **KQ-LMPC: Koopman LMPC for Quadrotors**

 > ğŸš€ **KQ-LMPC is the fastest open-source Koopman MPC controller for quadrotors: zero training data, fully explainable, hardware-proven SE(3) control.** 
 
 > âš¡ Real-time convex MPC (<10 ms) â€¢ âœ… Stability guarantees â€¢ ğŸ”§ PX4/ROS2 ready

 [![PyPI Version](https://img.shields.io/pypi/v/kq-lmpc-quadrotor.svg)](https://pypi.org/project/kq-lmpc-quadrotor/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Python](https://img.shields.io/badge/python-3.8+-blue.svg)]()
[![Paper](https://img.shields.io/badge/Peer--Reviewed-IEEE%20RA--L%202025-darkred)](https://www.researchgate.net/publication/396545942_Real-Time_Linear_MPC_for_Quadrotors_on_SE3_An_Analytical_Koopman-based_Realization)
[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.17393835.svg)](https://doi.org/10.5281/zenodo.17393835)
[![Stars](https://img.shields.io/github/stars/santoshrajkumar/kq-lmpc-quadrotor?style=social)]()


<h4><code>kq_lmpc_quadrotor</code> â€” A **hardware-ready Python package** for **Koopman-based Linear Model Predictive Control (LMPC)**. Built for **real-time flight**, powered by **analytical Koopman lifting** (no neural networks, no learning phase).</h4>


<p align="center">
  <a href="https://github.com/santoshrajkumar/kq-lmpc-quadrotor">
    <img src="https://img.shields.io/badge/â­_Star_this_repo_for_updates!-red?style=for-the-badge">
  </a>
</p>


<p align="center">
  âœ… First hardware-validated Koopman MPC on SE(3)  
  âœ… Convex QP (<10 ms solve time) via acados  
  âœ… PX4/ROS2/MAVSDK compatible : deploy to drones easily  
</p>


<div align="center">

ğŸ”§ **acados-powered QP** <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/python/python-original.svg" width="20" />
â€ƒ|â€ƒğŸ§­ **LPV + LTI Koopman Embedding**
â€ƒ|â€ƒğŸš€ **PX4 Offboard Ready**

</div>


<table align="center">
  <tr>
    <td>
      <img src="media/dg.GIF" height="200px" width="350px" style="border-radius:8px;"/>
    </td>
    <td>
      <img src="media/dg2.gif" height="200px" width="350px" style="border-radius:8px;"/>
    </td>
  </tr>
</table>

<p align="center">
  <img src="https://img.shields.io/badge/Koopman-Lifting-blue" />
  <img src="https://img.shields.io/badge/KQ--LMPC-Convex%20MPC-red" />
  <img src="https://img.shields.io/badge/Python-Package-success" />
  <img src="https://img.shields.io/badge/MATLAB-Code-orange?logo=mathworks&logoColor=white" />
  <img src="https://img.shields.io/badge/Research-Backed-lightgrey" />
  <img src="https://img.shields.io/badge/Academic%20Code-âœ“-blue" />
  <img src="https://img.shields.io/badge/Reproducibility-âœ“-brightgreen" />
  </a>
</p>
</div>


## ğŸŒŸ Key Features

âœ… **Analytical Koopman lifting** with **generalizable observables**  
&nbsp;&nbsp;&nbsp;&nbsp;â†’ No neural networks, no training, no data fitting required  

âœ… **Data-free Koopman-lifted LTI + LPV models**  
&nbsp;&nbsp;&nbsp;&nbsp;â†’ Derived directly from **SE(3) quadrotor dynamics** using Lie algebra structure  

âœ… **Real-time Linear MPC (LMPC)**  
&nbsp;&nbsp;&nbsp;&nbsp;â†’ Solved as a **single convex QP** termed **KQ-LMPC**  
&nbsp;&nbsp;&nbsp;&nbsp;â†’ < **10 ms** solve time on **Jetson NX / embedded hardware**  

âœ… **Trajectory tracking on SE(3)**  
&nbsp;&nbsp;&nbsp;&nbsp;â†’ **Provable controllability** in lifted Koopman space  

âœ… **Closed-loop robustness guarantees**  
&nbsp;&nbsp;&nbsp;&nbsp;â†’ **Input-to-state practical stability (I-ISpS)**  

âœ… **Hardware-ready integration**  
&nbsp;&nbsp;&nbsp;&nbsp;â†’ Works with **PX4 Offboard Mode**, **ROS2**, **MAVSDK**, **MAVROS**  

âœ… **Drop-in MPC module**  
&nbsp;&nbsp;&nbsp;&nbsp;â†’ for both KQ-LMPC, NMPC with acados on Python.

## â— Why It Matters
Real-time control of agile aerial robots is still dominated by **slow NMPC** or **black-box learning-based controllers**. One is too **computationally heavy**, the other is **unsafe without guarantees**.

**KQ-LMPC bridges this gap** by enabling **convex MPC for nonlinear quadrotor dynamics** using Koopman operator theory. This means:
âœ… **Real-time feasibility (<10 ms solve time)**  
âœ… **Explainable, physics-grounded control**  
âœ… **Robustness guarantees (I-ISpS)**  
âœ… **Ready for PX4/ROS2 deployment**


## ğŸ§  Paper

This work is based on:

> **"Real-Time Linear MPC for Quadrotors on SE(3): An Analytical Koopman-based Realization"**  
> *IEEE Robotics and Automation Letters (RA-L), 2025* (To appear)  
> **Santosh Rajkumar**, Chengyu Yang, Yuliang Gu, Sheng Cheng, Naira Hovakimyan, Debdipta Goswami  
> [[Paper PDF]](media/paper.pdf) â€¢ [[ArXiv]](https://arxiv.org/abs/2409.12374) â€¢ [[Video Demos]](https://soarpapers.github.io/)

If you use this repository, **please cite us** ğŸ™

```bibtex
@article{rajkumar2025kqlmpc,
  title={Real-Time Linear MPC for Quadrotors on SE(3): An Analytical Koopman-based Realization},
  author={Rajkumar, Santosh and Yang, Chengyu and Gu, Yuliang and Cheng, Sheng and Hovakimyan, Naira and Goswami, Debdipta},
  journal={IEEE Robotics and Automation Letters},
  year={2025}
}
```
## ğŸ”§ Installation

*Virtual environment recommended

Install from PyPI (recommended):

```bash
pip install kq-lmpc-quadrotor
```

Install from source

```bash
git clone https://github.com/santoshrajkumar/kq-lmpc-quadrotor.git
cd kq-lmpc-quadrotor
pip install -e .
```

## âš¡ Quick Demo
```bash
from kq_lmpc_quadrotor import lqr_demo
lqr_demo()
```
<p align="center">
  <a href="https://colab.research.google.com/github/santoshrajkumar/kq-lmpc-quadrotor/blob/main/examples/Notebooks/quick_demo.ipynb">
    <img src="https://img.shields.io/badge/Launch%20Demo-Colab-blue?logo=googlecolab&style=for-the-badge" height="30">
  </a>
</p>


### âš ï¸ **Important Dependency Notice**
* This package relies on **acados** for fast Model Predictive Control (MPC).  
* You must configure **acados + Python interface** before running MPC examples.
* Recommended that you install acados and configure, before installing the package if you are going to use MPC.
* Koopman Lifting and LQR will work without acados installation
 * **Quick Setup Checklist**
 - Install acados âœ…
 - Enable Python interface âœ…
 - Export `ACADOS_SOURCE_DIR` âœ…
 - Set library paths:
   - Linux: `LD_LIBRARY_PATH`
   - macOS: `DYLD_LIBRARY_PATH`

* ğŸ“š Install acados: https://docs.acados.org/installation/index.html  
* ğŸ acados Python Interface: https://docs.acados.org/python_interface/index.html  
* ğŸ’» OS Support: **Linux/macOS** (*Not tested on Windows*)

```bash
from kq_lmpc_quadrotor import kqlmpc_demo
kqlmpc_demo()
```

## â¤´ï¸ Koopman Lifting

<p align="center">
  <a href="https://colab.research.google.com/github/santoshrajkumar/kq-lmpc-quadrotor/blob/main/examples/Notebooks/koopman_lifting.ipynb">
    <img src="https://img.shields.io/badge/Launch%20Demo-Colab-blue?logo=googlecolab&style=for-the-badge" height="30">
  </a>
</p>

<p align="center">
  <a href="https://github.com/santoshrajkumar/kq-lmpc-quadrotor/tree/main/MATLAB">
    <img src="https://img.shields.io/badge/MATLAB%20Demo-Code-orange?style=for-the-badge&logo=mathworks&logoColor=white">
  </a>
</p>

## ğŸ“Š Benchmarking: KQ-LMPC vs NMPC

* Python 3.10 â€¢ Ubuntu 22.04 â€¢ AMD Ryzen 3 PRO CPU  
* Metrics: **Mean solve time** (Î¼â‚œ), **Worst-case solve time** (táµ¥), and **Tracking RMSE** (ğ“”â‚›).  
* Prediction horizon **Tâ‚• âˆˆ {0.8, 1.4, 2.0, 2.8} s** across **4 tasks**.
* 4 Benchmark Tasks:
  - Task 1 : Follow a Line and Hover
  - Task 2 : Follow a vertically moving helical path.
  - Task 3 : Follow a lemniscate trajectory
  - Task 4 : Follow a knot trajectory.


<center>
<figure style="display:inline-block;margin:0">
  <img src="media/comptime.svg" alt="Your alt text"
       style="max-width:50%;border:1px solid #d0d7de;border-radius:6px;">
  <figcaption style="font-size:0.9em;color:#666;text-align:center;margin-top:6px">
    Computation time comparison (ms)
  </figcaption>
</figure>
</center>

<br>

<center>
<figure style="display:inline-block;margin:0">
  <img src="media/rmse.svg" alt="Your alt text"
       style="max-width:50%;border:1px solid #d0d7de;border-radius:6px;">
  <figcaption style="font-size:0.9em;color:#666;text-align:center;margin-top:6px">
    Tracking RMSE (m) comparison
  </figcaption>
</figure>
</center>

### ğŸ” Highlights

- âœ… **2â€“4Ã— faster mean computation time** than NMPC  
- âœ… **Lower worst-case latency** â†’ more reliable for real-time flight  
- âœ… **Competitive tracking accuracy**  
- âœ… **Scales efficiently** with larger prediction horizons

---

ğŸš€ **v2.0 (Coming Soon)**  
ğŸ”§ **Complete PX4 Offboard control pipeline for hardware**  
ğŸ”§ **Full Gazebo SITL + PX4 integration demos**    
ğŸ”§ **Flight-ready example configs**

If you find this project useful, please â­ star the repo and follow â€” your support drives development!

<p align="center">
  <a href="https://twitter.com/intent/tweet?text=Real-time%20Koopman%20MPC%20for%20quadrotors!%20%F0%9F%9A%81%20Convex%20QP%20MPC%20on%20SE(3)%2C%20no%20neural%20networks.%20Check%20this%20open%20source%20project%20by%20%40SantoshRajkumar%20&url=https://github.com/santoshrajkumar/kq-lmpc-quadrotor">
    <img src="https://img.shields.io/badge/Share_on_Twitter-1DA1F2?style=for-the-badge&logo=twitter&logoColor=white"/>
  </a>
  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://github.com/santoshrajkumar/kq-lmpc-quadrotor">
    <img src="https://img.shields.io/badge/Share_on_LinkedIn-0077B5?style=for-the-badge&logo=linkedin&logoColor=white"/>
  </a>
</p>
