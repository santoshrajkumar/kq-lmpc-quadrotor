
# ğŸš ğŸ›¸ **KQ-LMPC: Koopman Quasi-Linear MPC for Quadrotors**

[![PyPI Version](https://img.shields.io/pypi/v/kq-lmpc-quadrotor.svg)](https://pypi.org/project/kq-lmpc-quadrotor/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Python](https://img.shields.io/badge/python-3.8+-blue.svg)]()
[![Paper](https://img.shields.io/badge/IEEE-RA--L%202025-red)](https://www.researchgate.net/publication/396545942_Real-Time_Linear_MPC_for_Quadrotors_on_SE3_An_Analytical_Koopman-based_Realization)
[![Stars](https://img.shields.io/github/stars/santoshrajkumar/kq-lmpc-quadrotor?style=social)]()


<div align="center">

### **Analytical Koopman Lifting â†’ Convex MPC (< 10ms Jetson ![Jetson Optimized](https://img.shields.io/badge/Jetson-NVIDIA-green?logo=nvidia) ) â†’ Real-Time Flight on SE(3)**  
**Zero Data â€¢ Zero Neural Networks â€¢ Fully Explainable Control**


ğŸ”§ **acados-powered QP** <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/python/python-original.svg" width="20" />
â€ƒ|â€ƒğŸ§­ **LPV + LTI Koopman Embedding**â€ƒ| â€ƒğŸš€ **PX4/ROS2/MAVSDK Ready**

`pip install kq-lmpc-quadrotor`

</div>
<p align="center">
  <b><code>kq_lmpc_quadrotor</code></b>: A complete, hardware-ready Python package for <b>Koopman-based Linear Model Predictive Control (LMPC)</b>, 
  delivering <b>real-time trajectory tracking</b> for quadrotors using <b>analytical Koopman lifting</b> (no training data required).
</p>

<p align="center">
  âœ… First hardware-deployed real-time Linear MPC for quadrotors derived using Koopman operator theory, no data required.
</p>

<table align="center">
  <tr>
    <td>
      <img src="media/dg.GIF" height="200px" width="400px" style="border-radius:8px;"/>
    </td>
    <td>
      <img src="media/dg2.gif" height="200px" width="400px" style="border-radius:8px;"/>
    </td>
  </tr>
</table>


<p align="center">
  <img src="https://img.shields.io/badge/Koopman-Lifting-blue" />
  <img src="https://img.shields.io/badge/KQ--LMPC-Convex%20MPC-red" />
  <img src="https://img.shields.io/badge/Python-Package-success" />
  <img src="https://img.shields.io/badge/Research-Backed-lightgrey" />
</p>

---


## ğŸŒŸ Key Features

âœ… **Analytical Koopman lifting** with **generalizable observables**  
&nbsp;&nbsp;&nbsp;&nbsp;â†’ No neural networks, no training, no data fitting required  

âœ… **Data-free Koopman-lifted LTI + LPV models**  
&nbsp;&nbsp;&nbsp;&nbsp;â†’ Derived directly from **SE(3) quadrotor dynamics** using Lie algebra structure  

âœ… **Real-time Linear MPC (LMPC)**  
&nbsp;&nbsp;&nbsp;&nbsp;â†’ Solved as a **single convex QP** termed **KQ-LMPC**  
&nbsp;&nbsp;&nbsp;&nbsp;â†’ < **10 ms** solve time on **Jetson NX / embedded hardware**  

âœ… **Trajectory tracking on SE(3)**  
&nbsp;&nbsp;&nbsp;&nbsp;â†’ **Provable controllability** in lifted Koopman space  

âœ… **Closed-loop robustness guarantees**  
&nbsp;&nbsp;&nbsp;&nbsp;â†’ **Input-to-state practical stability (I-ISpS)**  

âœ… **Hardware-ready integration**  
&nbsp;&nbsp;&nbsp;&nbsp;â†’ Works with **PX4 Offboard Mode**, **ROS2**, **MAVSDK**, **MAVROS**  

âœ… **Drop-in MPC module**  
&nbsp;&nbsp;&nbsp;&nbsp;â†’ for both KQ-LMPC, NMPC with acados on Python.

---

## ğŸ§  Paper

This work is based on:

> **"Real-Time Linear MPC for Quadrotors on SE(3): An Analytical Koopman-based Realization"**  
> *IEEE Robotics and Automation Letters (RA-L), 2025* (To appear)  
> **Santosh Rajkumar**, Chengyu Yang, Yuliang Gu, Sheng Cheng, Naira Hovakimyan, Debdipta Goswami  
> [[Paper PDF]](media/paper.pdf) â€¢ [[ArXiv]](https://arxiv.org/abs/2409.12374) â€¢ [[Video Demos]](https://soarpapers.github.io/)

If you use this repository, **please cite us** ğŸ™

```bibtex
@article{rajkumar2025kqlmpc,
  title={Real-Time Linear MPC for Quadrotors on SE(3): An Analytical Koopman-based Realization},
  author={Rajkumar, Santosh and Yang, Chengyu and Gu, Yuliang and Cheng, Sheng and Hovakimyan, Naira and Goswami, Debdipta},
  journal={IEEE Robotics and Automation Letters},
  year={2025}
}
```
## ğŸ”§ Installation

*Virtual environment recommended

Install from PyPI (recommended):

```bash
pip install kq_lmpc_quadrotor
```

Install from source

```bash
git clone https://github.com/santoshrajkumar/kq-lmpc-quadrotor.git
cd kq-lmpc-quadrotor
pip install -e .
```

## âš¡ Quick Demo
```bash
from kq_lmpc_quadrotor import lqr_demo
lqr_demo()
```
```bash
kqlmpc_demo
```
> âš ï¸ **Important Dependency Notice**
> This package relies on **acados** for fast Model Predictive Control (MPC).  
> You must configure **acados + Python interface** before running MPC examples.
>
> **Quick Setup Checklist**
> - Install acados âœ…
> - Enable Python interface âœ…
> - Export `ACADOS_SOURCE_DIR` âœ…
> - Set library paths:
>   - Linux: `LD_LIBRARY_PATH`
>   - macOS: `DYLD_LIBRARY_PATH`
>
> ğŸ“š Install acados: https://docs.acados.org/installation/index.html  
> ğŸ acados Python Interface: https://docs.acados.org/python_interface/index.html  
> ğŸ’» OS Support: **Linux/macOS** (*Not tested on Windows*)


### ğŸ“Š Benchmarking: KQ-LMPC vs NMPC (Numerical Simulation)

**Experimental Setup:**  
Python 3.10 â€¢ Ubuntu 22.04 â€¢ AMD Ryzen 3 PRO CPU  
Metrics: **Mean solve time** (Î¼â‚œ), **Worst-case solve time** (táµ¥), and **Tracking RMSE** (ğ“”â‚›).  
Prediction horizon **Tâ‚• âˆˆ {0.8, 1.4, 2.0, 2.8} s** across **4 tasks**.

---

| **Method** | **Metric** | **Tâ‚• = 0.8 s** (Tasks 1â€“4) | **Tâ‚• = 1.4 s** (Tasks 1â€“4) | **Tâ‚• = 2.0 s** (Tasks 1â€“4) | **Tâ‚• = 2.8 s** (Tasks 1â€“4) |
|------------|------------|-----------------------------|-----------------------------|-----------------------------|-----------------------------|
| **KQ-LMPC** | **Î¼â‚œ (ms)** | 0.32 â€¢ 0.32 â€¢ 0.33 â€¢ 0.34 | 0.47 â€¢ 0.47 â€¢ 0.51 â€¢ 0.50 | 0.78 â€¢ 0.80 â€¢ 0.90 â€¢ 0.87 | 1.04 â€¢ 1.07 â€¢ 1.31 â€¢ 1.23 |
|            | **táµ¥ (ms)** | 0.79 â€¢ 0.76 â€¢ 1.00 â€¢ 0.98 | 1.28 â€¢ 1.26 â€¢ 1.48 â€¢ 1.26 | 2.25 â€¢ 2.18 â€¢ 2.49 â€¢ 2.13 | 2.63 â€¢ 2.85 â€¢ 5.00 â€¢ 3.32 |
|            | **ğ“”â‚› (m)**  | 0.06 â€¢ 0.09 â€¢ 0.10 â€¢ 0.13 | 0.05 â€¢ 0.06 â€¢ 0.14 â€¢ 0.18 | 0.05 â€¢ 0.04 â€¢ 0.10 â€¢ 0.12 | 0.05 â€¢ 0.05 â€¢ 0.14 â€¢ 0.15 |
| **NMPC**    | **Î¼â‚œ (ms)** | 0.86 â€¢ 0.97 â€¢ 1.18 â€¢ 1.46 | 1.14 â€¢ 1.20 â€¢ 1.68 â€¢ 2.05 | 1.69 â€¢ 1.75 â€¢ 2.70 â€¢ 3.24 | 1.96 â€¢ 2.13 â€¢ 3.35 â€¢ 4.15 |
|            | **táµ¥ (ms)** | 2.38 â€¢ 2.20 â€¢ 2.46 â€¢ 3.88 | 3.07 â€¢ 4.12 â€¢ 5.25 â€¢ 6.48 | 4.48 â€¢ 4.53 â€¢ 8.52 â€¢ 9.47 | 4.66 â€¢ 6.60 â€¢ 10.68 â€¢ 11.78 |
|            | **ğ“”â‚› (m)**  | 0.05 â€¢ 0.07 â€¢ 0.09 â€¢ 0.09 | 0.06 â€¢ 0.06 â€¢ 0.10 â€¢ 0.12 | 0.04 â€¢ 0.06 â€¢ 0.06 â€¢ 0.07 | 0.04 â€¢ 0.05 â€¢ 0.08 â€¢ 0.09 |

---

### ğŸ” Highlights

- âœ… **2â€“4Ã— faster mean computation time** than NMPC  
- âœ… **Lower worst-case latency** â†’ more reliable for real-time flight  
- âœ… **Competitive tracking accuracy**  
- âœ… **Scales efficiently** with larger prediction horizons

---

ğŸš€ **v2.0 (Coming Soon)**  
ğŸ”§ **Complete PX4 Offboard control pipeline for hardware**  
ğŸ”§ **Full Gazebo SITL + PX4 integration demos**    
ğŸ”§ **Flight-ready example configs**

If you find this project useful, please â­ star the repo and follow â€” your support drives development!
